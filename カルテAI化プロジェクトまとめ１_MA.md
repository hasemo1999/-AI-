# 眼科カルテAI化プロジェクトまとめ（MA版）

## プロジェクト概要
- **目的**: 眼科クリニックの画像をローカルAIで管理・学習
- **データ規模**: 500GB程度のJPG画像
- **保存場所**: Googleドライブ
- **対象画像**: OCT、OCTA、眼底カメラ、ハンフリー視野計の結果JPG

## システム構成
### ハードウェア要件
- **CPU**: Intel Core i9-13900HX（24コア）
- **メモリ**: 64GB
- **SSD**: 1TB NVMe
- **GPU**: RTX 4070（8GB VRAM）
- **ストレージ**: 2TB Googleドライブ

### ソフトウェア構成
- **OS**: Windows 11 Home
- **同期**: Google Drive for Desktop
- **OCR**: Google Vision API / ローカルTesseract
- **AI**: BiomedCLIP、RETFound、MedSAM

## データ構造設計

### フォルダ構成
```
/GoogleDrive/
  /inbox/
    /chart/     # 紙カルテ写メ
    /nct/       # 非接触眼圧プリント
    /rxshot/    # レセコン画面スクショ
  /patients/{ID}/
    /notes/     # 生成されたMarkdown
    /images/    # 元画像
    /metrics/   # CSV（数値データ）
```

### データ形式
- **数値・構造化データ**: CSV/Parquet（台帳）
- **文章・所見**: Markdown（検索可能）
- **画像**: 元JPG（原本）

## 抽出対象データ

### OCTA（光干渉断層血管撮影）
- FAZ面積（mm²）
- 血管密度（SCP/DCP、%）
- 無灌流領域面積（mm²）
- スキャンサイズ（3×3mm/6×6mm）

### HFA（ハンフリー視野計）
- MD（Mean Deviation、dB）
- PSD（Pattern Standard Deviation、dB）
- VFI（Visual Field Index、%）
- 戦略（SITA-Std/Fast）
- パターン（24-2/10-2）

### OCT（光干渉断層）
- RNFL平均厚（µm）
- GCIPL平均厚（µm）
- セクター別値（I/S/N/T）

### 眼圧データ
- **非接触型（NCT）**: 3回測定＋平均値
- **接触型（GAT）**: 手書き記入→OCR抽出

## 自動化フロー

### 1. データ取り込み
- iPhoneで紙カルテ撮影
- 日付フォルダ（例：2025-08-08）に一括アップロード
- QRコードで患者ID自動判別

### 2. 自動処理
- PC側で新着画像を検知
- 画像種別を自動判別（OCT/OCTA/HFA/カルテ）
- OCRで数値・テキスト抽出
- 患者IDフォルダに自動振り分け

### 3. データ保存
- 数値はCSV台帳に追記
- 所見はMarkdown化
- 元画像は患者フォルダに保存

## AI学習戦略

### 段階的アプローチ
1. **学習済みモデル導入**: 既存の眼科AIを流用
2. **院内データで微調整**: LoRA/線形ヘッドで軽量学習
3. **継続学習**: 診察時の訂正を学習キューに蓄積

### 対象疾患
- **緑内障**: RNFL/GCIPL＋MDの二軸管理
- **AMD**: 中心窩厚・液体量の時系列追跡
- **DMR**: 浮腫・血管密度の変化監視

## 品質管理

### データ品質フラグ
- 外れ値検出（IOP: 5-35mmHg範囲外）
- 平均値整合性チェック（NCT: 3回平均との誤差±1mmHg以内）
- OCR信頼度スコア

### 手動確認
- 低信頼度データのみポップアップ表示
- 数値修正はテンキー入力で簡易化
- 修正履歴は学習データとして保存

## 運用メリット

### 効率化
- 撮影→Drive転送のみで自動処理
- 時系列グラフの自動生成
- 異常検出の自動フラグ付け

### 診断支援
- 来院時の即座な過去データ表示
- 進行判定の自動化
- 治療効果の定量的評価

### 学習効果
- 使用するほど精度向上
- 院内特化型AIの育成
- 教授級診断能力への到達可能性

## 実装優先順位

### Phase 1: 基盤構築
- Google Drive同期設定
- 患者IDフォルダ構造整備
- 基本OCRパイプライン構築

### Phase 2: 数値抽出
- NCT（非接触眼圧）の自動抽出
- HFA（視野）のMD/PSD/VFI抽出
- OCTAのFAZ・血管密度抽出

### Phase 3: 時系列管理
- 患者別時系列グラフ生成
- 異常検出アルゴリズム実装
- PDFレポート自動生成

### Phase 4: AI学習
- 学習済みモデル導入
- 院内データでの微調整
- 継続学習システム構築

## 技術的考慮事項

### 8GB VRAM制約への対応
- 推論中心の運用
- 入力サイズ: 384-512px
- fp16精度での処理
- 勾配蓄積によるメモリ節約

### セキュリティ
- 患者IDの匿名化（ハッシュ化）
- ローカル処理によるデータ保護
- アクセス権限の厳格管理

### バックアップ
- 原本はローカルPCに別保存
- Google Driveは作業用コピー
- 3-2-1バックアップ原則

## 成功指標

### 短期目標（3ヶ月）
- 500GBデータの完全同期
- 基本OCRパイプライン稼働
- 100症例での数値抽出精度90%以上

### 中期目標（1年）
- 全モダリティの自動抽出実現
- 時系列管理システム完成
- 診断支援ツールとして実用化

### 長期目標（3年）
- 院内特化型AIの完成
- 教授級診断精度の達成
- 継続学習による精度向上

## リスク管理

### 技術的リスク
- OCR精度の不安定性
- GPUメモリ不足
- ネットワーク同期エラー

### 運用リスク
- 手動入力の継続性
- データ品質の維持
- システム障害時の対応

### 対策
- 段階的実装によるリスク分散
- 品質チェック機能の充実
- バックアップ・復旧体制の整備
